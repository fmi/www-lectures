<!DOCTYPE html><html lang="bg"><head><meta charset="utf-8" /><!--[if lt IE 9]><script src="js/html5shim.js"></script><![endif]--><link href="css/styles.css" rel="stylesheet" /><link href="css/pygments.css" rel="stylesheet" /><script src="js/analytics.js"></script><title>03. Ruby, Rack and Routing</title></head><body><header><h1>03. Ruby, Rack and Routing</h1><nav><ul><li><button id="prev-btn" title="Previous slide">Previous Slide</button></li><li><span id="slide-number"></span> / <span id="slide-total"></span></li><li><button id="next-btn" title="Next Slide">Next Slide</button></li></ul></nav></header><div id="deck"><section><hgroup><h1>03. Ruby, Rack and Routing</h1></hgroup></section><section>
<hgroup><h1>Днес</h1></hgroup>
<ul><li class="action">Още малко ruby
</li><li class="action">Rack
</li><li class="action">routing</li></ul></section>
<section>
<hgroup><h1>Rack</h1><h2>що е то?</h2></hgroup>
<ul><li class="action">основата на всички модерни Ruby уеб феймуърци
</li><li class="action">мидълуеър
</li><li class="action">накратко... обще интерфейс между сървъра и приложението</li></ul></section>
<section>
<hgroup><h1>Rack</h1><h2>в картинки</h2></hgroup>
<div class="left"><img height="400" src="images/intro-rack.jpg" /></div><div class="right"><img height="400" src="images/rack-request-response.png" /></div></section>
<section>
<hgroup><h1>Rack application</h1><h2>що е то?</h2></hgroup>
<ul><li class="action">Ruby обект, който отговаря на метода <code>call</code>
</li><li class="action">приема като аргумент хеш с информация за environment-а
</li><li class="action">и връща масив с точно 3 стойности:
</li><li class="action">status
</li><li class="action">headers
</li><li class="action">body</li></ul></section>
<section>
<hgroup><h1>Ruby lambdas</h1><h2>лирическо отклонение</h2></hgroup>
<div class="highlight"><pre><span class="n">twice</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="p">}</span>
<span class="n">twice</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># =&gt; 10</span>

<span class="n">twice</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="p">}</span> <span class="c1"># 1.9 new syntax</span>
<span class="n">twice</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># =&gt; 10</span>
</pre>
</div>
</section>
<section>
<hgroup><h1>Rack application</h1><h2>Здравей свят!</h2></hgroup>
<p>Създайте файл `config.ru` в root директорията.</p><div class="highlight"><pre><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">&#39;rack&#39;</span>

<span class="n">run</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ContentType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">},</span> <span class="o">[</span><span class="s1">&#39;Hello world!&#39;</span><span class="o">]]</span> <span class="p">}</span>
</pre>
</div>
<p>Стартира се с `bundle exec rackup`</p></section>
<section>
<hgroup><h1>Rack application</h1><h2>малки подобрения</h2></hgroup>
<div class="highlight"><pre><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">&#39;rack&#39;</span>

<span class="n">run</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;Hello world!&#39;</span><span class="p">)</span> <span class="p">}</span>
</pre>
</div>
</section>
<section>
<hgroup><h1>Rack application</h1><h2>малко по-ООП</h2></hgroup>
<div class="highlight"><pre><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">&#39;rack&#39;</span>

<span class="k">module</span> <span class="nn">Tweeter</span>
  <span class="k">class</span> <span class="nc">Application</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">env</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>
<ul><li class="action">Но нали имаме контролер!
</li><li class="action">Защо не го използваме?!</li></ul></section>
<section>
<hgroup><h1>Rack application</h1><h2>using controller</h2></hgroup>
<div class="highlight"><pre><span class="o">...</span>
<span class="nb">require</span> <span class="s1">&#39;./app/controllers/user_controller&#39;</span>

<span class="k">module</span> <span class="nn">Tweeter</span>
  <span class="k">class</span> <span class="nc">Application</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
      <span class="n">controller</span> <span class="o">=</span> <span class="o">::</span><span class="no">UserController</span><span class="o">.</span><span class="n">new</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">show</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>
</section>
<section>
<hgroup><h1>Routing</h1></hgroup>
<ul><li class="action">накратко...
</li><li class="action">свързва заявка с двойка <контролер, метод>
</li><li class="action">как можем да го направим?
</li><li class="action">ще използваме <code>env</code>!!1!</li></ul></section>
<section>
<hgroup><h1>env</h1><h2>под лупа</h2></hgroup>
<ul><li class="action">REQUEST_METHOD: The HTTP verb of the request. This is required.
</li><li class="action">PATH_INFO: The request URL path, relative to the root of the application.
</li><li class="action">QUERY_STRING: Anything that followed ? in the request URL string.
</li><li class="action">SERVER_NAME and SERVER_PORT: The server's address and port.
</li><li class="action">rack.version: The rack version in use.
</li><li class="action">rack.url_scheme: is it http or https?
</li><li class="action">rack.input: an IO-like object that contains the raw HTTP POST data.
</li><li class="action">rack.errors: an object that response to puts, write, and flush.
</li><li class="action">rack.session: A key value store for storing request session data.
</li><li class="action">rack.logger: An object that can log interfaces. It should implement info, debug, warn, error, and fatal methods.</li></ul></section>
<section>
<hgroup><h1>Routing</h1><h2>проста имплементация</h2></hgroup>
<div class="highlight"><pre><span class="o">...</span>
<span class="k">class</span> <span class="nc">Application</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="o">::</span><span class="no">UserController</span><span class="o">.</span><span class="n">new</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span> <span class="o">||</span> <span class="n">env</span><span class="o">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;/show&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">show</span>
    <span class="k">elsif</span> <span class="n">env</span><span class="o">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;/following&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">following</span>
    <span class="k">elsif</span> <span class="n">env</span><span class="o">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;/followers&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">followers</span>
    <span class="k">else</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="s2">&quot;Page not found!&quot;</span><span class="p">,</span> <span class="mi">404</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="o">...</span>
</pre>
</div>
</section>
<section>
<hgroup><h1>Routing</h1><h2>защо да не използваме switch</h2></hgroup>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Application</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="o">::</span><span class="no">UserController</span><span class="o">.</span><span class="n">new</span>
    <span class="k">case</span> <span class="n">env</span><span class="o">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">&#39;/&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">show</span>
    <span class="k">when</span> <span class="s1">&#39;/show&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">show</span>
    <span class="k">when</span> <span class="s1">&#39;/following&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">following</span>
    <span class="k">when</span> <span class="s1">&#39;/followers&#39;</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="n">controller</span><span class="o">.</span><span class="n">followers</span>
    <span class="k">else</span>
      <span class="no">Rack</span><span class="o">::</span><span class="no">Response</span><span class="o">.</span><span class="n">new</span> <span class="s2">&quot;Page not found!&quot;</span><span class="p">,</span> <span class="mi">404</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>
</section>
<section>
<hgroup><h1>Сега на къде?</h1><h2>или как да надградим</h2></hgroup>
<ul></ul></section>
<section><hgroup><h1>Въпроси</h1></hgroup><ul><li><a href="http://moodle.openfmi.net/course/view.php?id=1911">http://moodle.openfmi.net/course/view.php?id=1911</a></li></ul></section></div><script src="js/jquery-1.5.2.min.js"></script><script src="js/jquery.jswipe-0.1.2.js"></script><script src="js/htmlSlides.js"></script><script src="js/pusher.js"></script><script type="text/javascript">$(function() {
  htmlSlides.init({ hideToolbar: true });
});

mixpanel.set_config({debug: true});

var pusher = new Pusher('a2024b659f492cab86cc');
pusher.subscribe('lectures');
pusher.bind('refresh', function(data) {
  location.reload(true);
});

try {
  mixpanel.track('Landing Page', {
    referrer: document.referrer,
    presentation: document.title
  });
} catch (e) {};</script></body></html>